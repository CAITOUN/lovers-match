<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4843958868558245"
     crossorigin="anonymous"></script>
    <meta name="description" content="Calculate your love compatibility based on Chinese Zodiac and BaZi. Discover your cosmic connection with our free compatibility calculator.">
    <meta name="keywords" content="love compatibility, Chinese zodiac, BaZi, relationship calculator, compatibility test">
    <link rel="canonical" href="https://loversmatchs.org">
    <meta property="og:title" content="Love Compatibility Calculator">
    <meta property="og:description" content="Discover your cosmic connection with our free Chinese Zodiac compatibility calculator">
    <meta property="og:url" content="https://loversmatchs.org">
    <meta property="og:type" content="website">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>❤️</text></svg>">
    <title>Love Compatibility Calculator - loversmatchs.org</title>
    <style>
        /* 全局样式 */
        :root {
            --apple-blue: #0071e3;
            --apple-light-blue: #64a7ff;
            --apple-pink: #ff375f;
            --apple-light-pink: #ffd3dc;
            --apple-green: #34c759;
            --apple-light-green: #d4f8e5;
            --apple-orange: #ff9500;
            --apple-light-gray: #f5f5f7;
            --apple-medium-gray: #86868b;
            --apple-dark-gray: #1d1d1f;
            --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--main-font);
            line-height: 1.5;
            color: var(--apple-dark-gray);
            background-color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(to right, var(--apple-pink), var(--apple-blue));
            color: white;
            border-radius: 12px;
            margin-bottom: 40px;
            position: relative;
        }
        
        .site-logo {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        
        .site-logo a {
            color: white;
            font-weight: 500;
            text-decoration: none;
            font-size: 1.1rem;
            transition: color 0.3s;
            opacity: 0.8;
        }
        
        .site-logo a:hover {
            opacity: 1;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        header p {
            font-size: 1.2rem;
            font-weight: 300;
        }
        
        /* 主要内容样式 */
        section {
            margin-bottom: 40px;
            padding: 30px;
            border-radius: 12px;
            background-color: var(--apple-light-gray);
        }
        
        .intro {
            text-align: center;
        }
        
        .intro h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--apple-dark-gray);
        }
        
        .intro p {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            color: var(--apple-medium-gray);
        }
        
        /* 计算器样式 */
        .calculator {
            background-color: white;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-section h3 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5rem;
            color: var(--apple-dark-gray);
        }
        
        .date-inputs {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
        }
        
        .person {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border-radius: 10px;
            background-color: var(--apple-light-gray);
            transition: transform 0.3s;
        }
        
        .person:hover {
            transform: translateY(-5px);
        }
        
        .person h4 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--apple-dark-gray);
        }
        
        .date-picker {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .time-picker {
            margin-top: 15px;
        }
        
        .time-picker select {
            width: 100%;
        }
        
        select {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            appearance: none;
            background-color: white;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1em;
        }
        
        select:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }
        
        button {
            display: block;
            margin: 30px auto 0;
            padding: 15px 30px;
            background-color: var(--apple-blue);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        button:hover {
            background-color: var(--apple-light-blue);
            transform: scale(1.05);
        }
        
        /* 结果样式 */
        .result-section {
            display: none;
            padding: 30px;
            border-radius: 10px;
            background-color: var(--apple-light-gray);
            margin-top: 30px;
            text-align: center;
        }
        
        .result-section.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            margin-bottom: 20px;
        }
        
        .result-header h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--apple-dark-gray);
        }
        
        .compatibility-score {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--apple-green) 0%, var(--apple-green) var(--score), #f0f0f0 var(--score), #f0f0f0 100%);
            position: relative;
        }
        
        .compatibility-score::before {
            content: "";
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
        }
        
        .score-text {
            position: relative;
            z-index: 1;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--apple-dark-gray);
        }
        
        .compatibility-details {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin-top: 30px;
            gap: 20px;
        }
        
        .compatibility-item {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .compatibility-item h4 {
            margin-bottom: 10px;
            color: var(--apple-dark-gray);
        }
        
        .compatibility-item p {
            color: var(--apple-medium-gray);
        }
        
        /* 解释部分样式 */
        .explanation {
            padding: 40px;
            margin-top: 40px;
            background-color: var(--apple-light-gray);
            border-radius: 16px;
        }
        
        .explanation h2 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.2rem;
            color: var(--apple-dark-gray);
        }
        
        .explanation-content {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
        }
        
        .zodiac-info, .bazi-info {
            flex: 1;
            min-width: 300px;
            padding: 35px;
            border-radius: 16px;
            background-color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        
        .zodiac-info h3, .bazi-info h3 {
            margin-bottom: 25px;
            color: var(--apple-blue);
            font-size: 1.6rem;
        }
        
        .zodiac-info h4, .bazi-info h4 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--apple-dark-gray);
            font-size: 1.3rem;
        }
        
        .zodiac-info p, .bazi-info p {
            line-height: 1.8;
            margin-bottom: 20px;
            color: #333;
            font-size: 1.05rem;
        }
        
        .zodiac-info ul, .bazi-info ul {
            padding-left: 20px;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .zodiac-info li, .bazi-info li {
            margin-bottom: 12px;
            padding-left: 5px;
        }
        
        /* 分析类型选择器样式 */
        .analysis-selector {
            text-align: center;
            padding: 30px;
            margin-bottom: 20px;
            background-color: var(--apple-light-gray);
            border-radius: 12px;
        }
        
        .analysis-selector h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--apple-dark-gray);
        }
        
        .analysis-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .analysis-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px 30px;
            background: white;
            border: 3px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            color: var(--apple-dark-gray);
        }
        
        .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-btn.active {
            border-color: var(--apple-blue);
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-light-blue));
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .btn-icon {
            font-size: 2rem;
        }
        
        .btn-text {
            text-align: left;
        }
        
        .btn-text strong {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }
        
        .btn-text small {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* MBTI 输入样式 */
        .mbti-inputs {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
        }
        
        .mbti-selector {
            width: 100%;
        }
        
        .mbti-selector select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            background-color: white;
            color: var(--apple-dark-gray);
            transition: border-color 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1em;
        }
        
        .mbti-selector select option {
            background-color: white;
            color: var(--apple-dark-gray);
            padding: 10px;
        }
        
        .mbti-selector select:focus {
            border-color: var(--apple-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }
        
        /* MBTI 结果显示样式 */
        .mbti-types {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            font-size: 1.5rem;
        }
        
        .mbti-type {
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-light-blue));
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .vs {
            font-size: 2rem;
            animation: heartBeat 1.5s infinite;
        }
        
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .overall-compatibility {
            text-align: center;
            background: linear-gradient(135deg, var(--apple-light-green), #e8f5e8);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .overall-compatibility h4 {
            color: var(--apple-dark-gray);
            font-size: 1.4rem;
            margin-bottom: 15px;
        }
        
        .relationship-advice {
            background: var(--apple-light-pink);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            text-align: center;
        }
        
        .relationship-advice h4 {
            color: var(--apple-dark-gray);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        /* 新增的生肖网格布局 */
        .zodiac-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .zodiac-item {
            background-color: var(--apple-light-gray);
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .zodiac-item:hover {
            background-color: var(--apple-light-pink);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        /* BaZi因素布局 */
        .bazi-factors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .bazi-factor {
            background-color: var(--apple-light-gray);
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s ease;
        }
        
        .bazi-factor:hover {
            background-color: var(--apple-light-blue);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .factor-title {
            margin-bottom: 10px;
            color: var(--apple-dark-gray);
            font-size: 1.05rem;
        }
        
        .factor-desc {
            color: var(--apple-medium-gray);
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        /* 页脚样式 */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--apple-medium-gray);
            font-size: 0.9rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header {
                padding: 30px 0;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
            
            section {
                padding: 20px;
            }
            
            .intro h2 {
                font-size: 1.6rem;
            }
            
            .compatibility-score {
                width: 120px;
                height: 120px;
            }
            
            .compatibility-score::before {
                width: 90px;
                height: 90px;
            }
            
            .score-text {
                font-size: 2rem;
            }
            
            /* 解释部分的移动设备优化 */
            .explanation {
                padding: 25px 15px;
            }
            
            .explanation h2 {
                font-size: 1.8rem;
                margin-bottom: 25px;
            }
            
            .zodiac-info, .bazi-info {
                padding: 20px;
            }
            
            .zodiac-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .bazi-factors {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .zodiac-item, .bazi-factor {
                padding: 12px;
            }
            
            /* 移动端图表优化 */
            .chart-wrapper {
                max-width: 250px;
            }
            
            .bazi-chart {
                padding: 15px 10px;
                min-width: 280px;
            }
            
            .bazi-pillars {
                gap: 10px;
            }
            
            .pillar {
                width: 50px;
            }
            
            .stem, .branch {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
        
        /* 八字命盘样式 */
        .bazi-charts {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--apple-light-gray);
            border-radius: 12px;
        }
        
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
        }
        
        .bazi-chart {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .bazi-chart h5 {
            margin: 15px 0;
            color: var(--apple-dark-gray);
        }
        
        .chart-wrapper {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            position: relative;
        }
        
        .bazi-pillars {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .pillar {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        
        .stem, .branch {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
        }
        
        .stem {
            background-color: var(--apple-light-pink);
            color: var(--apple-pink);
            margin-bottom: 5px;
        }
        
        .branch {
            background-color: var(--apple-light-blue);
            color: var(--apple-blue);
        }
        
        .pillar .label {
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--apple-medium-gray);
        }
        
        canvas {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
        }

        /* 分享和保存功能样式 */
        .share-save-section {
            margin-top: 30px;
            text-align: center;
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .share-btn, .save-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--main-font);
        }

        .share-btn {
            background-color: var(--apple-blue);
            color: white;
        }

        .share-btn:hover {
            background-color: var(--apple-light-blue);
            transform: translateY(-2px);
        }

        .save-btn {
            background-color: var(--apple-green);
            color: white;
        }

        .save-btn:hover {
            background-color: #2db84a;
            transform: translateY(-2px);
        }

        .share-link-container {
            background-color: var(--apple-light-gray);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .share-link-container p {
            margin-bottom: 10px;
            color: var(--apple-medium-gray);
        }

        .link-input-group {
            display: flex;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        .link-input-group input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            background-color: white;
        }

        .copy-btn {
            padding: 12px 20px;
            background-color: var(--apple-orange);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .copy-btn:hover {
            background-color: #e6860a;
        }

        .load-record-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--apple-light-gray);
            border-radius: 10px;
        }

        .load-record-btn {
            padding: 10px 20px;
            background-color: var(--apple-medium-gray);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .load-record-btn:hover {
            background-color: #6a6a6f;
        }

        .load-record-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 600px) {
            .share-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .share-buttons button {
                width: 200px;
            }
            
            .link-input-group {
                flex-direction: column;
            }
            
            .link-input-group input,
            .copy-btn {
                width: 100%;
            }
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GDFKZCSRGH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GDFKZCSRGH');
</script>
<body>
    <div class="container">
        <header>
            <h1>Cosmic Love Connection</h1>
            <p>Discover Your Destiny Based on Ancient Chinese Wisdom</p>
            <div class="site-logo">
                <a href="https://loversmatchs.org" title="loversmatchs.org">loversmatchs.org</a>
            </div>
        </header>
        
        <main>
            <section class="intro">
                <h2>Discover Your Celestial Connection</h2>
                <p>In Chinese tradition, the Zodiac and BaZi are mystical keys to predicting emotional harmony between two souls. Enter your birthdays, and we'll reveal your zodiac compatibility, elemental balance, and provide a comprehensive analysis of your connection. Every relationship is a cosmic miracle carefully woven by the universe - unlock your love's hidden code now!</p>
            </section>
            
            <!-- Analysis Type Selector -->
            <section class="analysis-selector">
                <h3>Choose Your Analysis Type</h3>
                <div class="analysis-buttons">
                    <button id="bazi-mode-btn" class="analysis-btn active">
                        <span class="btn-icon">🔮</span>
                        <span class="btn-text">
                            <strong>BaZi Compatibility</strong>
                            <small>Chinese BaZi & Zodiac</small>
                        </span>
                    </button>
                    <button id="mbti-mode-btn" class="analysis-btn">
                        <span class="btn-icon">🧠</span>
                        <span class="btn-text">
                            <strong>MBTI Compatibility</strong>
                            <small>Personality Matching</small>
                        </span>
                    </button>
                </div>
            </section>
            
            <!-- BaZi Calculator -->
            <section class="calculator" id="bazi-calculator">
                <div class="load-record-section" id="load-record-section" style="display: none;">
                    <p>Previous record found</p>
                    <button id="load-record-btn" class="load-record-btn">Load Previous Record</button>
                </div>
                
                <div class="input-section">
                    <h3>Enter Your Birthdays to Unveil Your Cosmic Bond</h3>
                    <div class="date-inputs">
                        <div class="person">
                            <h4>Your Birthday</h4>
                            <div class="date-picker">
                                <select id="year1">
                                    <!-- Years will be generated by JavaScript -->
                                </select>
                                <select id="month1">
                                    <!-- Months will be generated by JavaScript -->
                                </select>
                                <select id="day1">
                                    <!-- Days will be generated by JavaScript -->
                                </select>
                            </div>
                            <div class="time-picker">
                                <select id="hour1">
                                    <!-- Hours will be generated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="person">
                            <h4>Your Partner's Birthday</h4>
                            <div class="date-picker">
                                <select id="year2">
                                    <!-- Years will be generated by JavaScript -->
                                </select>
                                <select id="month2">
                                    <!-- Months will be generated by JavaScript -->
                                </select>
                                <select id="day2">
                                    <!-- Days will be generated by JavaScript -->
                                </select>
                            </div>
                            <div class="time-picker">
                                <select id="hour2">
                                    <!-- Hours will be generated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <button id="calculate-btn">Reveal Your Cosmic Connection</button>
                </div>
                
                <div class="result-section" id="result-section">
                    <!-- 结果将在这里显示 -->
                </div>
            </section>
            
            <!-- MBTI Calculator -->
            <section class="calculator" id="mbti-calculator" style="display: none;">
                <div class="input-section">
                    <h3>Select Your MBTI Types for Compatibility Analysis</h3>
                    <div class="mbti-inputs">
                        <div class="person">
                            <h4>Your MBTI Type</h4>
                            <div class="mbti-selector">
                                <select id="mbti1">
                                    <option value="">Select Your MBTI Type</option>
                                    <option value="INTJ">INTJ - The Architect</option>
                                    <option value="INTP">INTP - The Logician</option>
                                    <option value="ENTJ">ENTJ - The Commander</option>
                                    <option value="ENTP">ENTP - The Debater</option>
                                    <option value="INFJ">INFJ - The Advocate</option>
                                    <option value="INFP">INFP - The Mediator</option>
                                    <option value="ENFJ">ENFJ - The Protagonist</option>
                                    <option value="ENFP">ENFP - The Campaigner</option>
                                    <option value="ISTJ">ISTJ - The Logistician</option>
                                    <option value="ISFJ">ISFJ - The Defender</option>
                                    <option value="ESTJ">ESTJ - The Executive</option>
                                    <option value="ESFJ">ESFJ - The Consul</option>
                                    <option value="ISTP">ISTP - The Virtuoso</option>
                                    <option value="ISFP">ISFP - The Adventurer</option>
                                    <option value="ESTP">ESTP - The Entrepreneur</option>
                                    <option value="ESFP">ESFP - The Entertainer</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="person">
                            <h4>Your Partner's MBTI Type</h4>
                            <div class="mbti-selector">
                                <select id="mbti2">
                                    <option value="">Select Partner's MBTI Type</option>
                                    <option value="INTJ">INTJ - The Architect</option>
                                    <option value="INTP">INTP - The Logician</option>
                                    <option value="ENTJ">ENTJ - The Commander</option>
                                    <option value="ENTP">ENTP - The Debater</option>
                                    <option value="INFJ">INFJ - The Advocate</option>
                                    <option value="INFP">INFP - The Mediator</option>
                                    <option value="ENFJ">ENFJ - The Protagonist</option>
                                    <option value="ENFP">ENFP - The Campaigner</option>
                                    <option value="ISTJ">ISTJ - The Logistician</option>
                                    <option value="ISFJ">ISFJ - The Defender</option>
                                    <option value="ESTJ">ESTJ - The Executive</option>
                                    <option value="ESFJ">ESFJ - The Consul</option>
                                    <option value="ISTP">ISTP - The Virtuoso</option>
                                    <option value="ISFP">ISFP - The Adventurer</option>
                                    <option value="ESTP">ESTP - The Entrepreneur</option>
                                    <option value="ESFP">ESFP - The Entertainer</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <button id="calculate-mbti-btn">Analyze MBTI Compatibility</button>
                </div>
                
                <div class="result-section" id="mbti-result-section">
                    <!-- MBTI结果将在这里显示 -->
                </div>
            </section>
            
            <section class="explanation">
                <h2>The Mystical Secrets of Chinese Zodiac & BaZi Love Matching</h2>
                <div class="explanation-content">
                    <div class="zodiac-info">
                        <h3>Chinese Zodiac - The Love Code</h3>
                        <p>The Chinese zodiac encompasses twelve animal signs, each representing unique personality traits and destiny paths. Zodiac compatibility is not just ancient wisdom crystallized, but a mystical code revealing the emotional harmony between two people, giving us a glimpse into the divine plan.</p>
                        
                        <h4>Compatibility Rules</h4>
                        <p>Zodiac matching is primarily based on these principles:</p>
                        <ul>
                            <li><strong>Trines (三合):</strong> Animals four years apart form the most harmonious relationships. 
                                <br>Example: Rat, Dragon, and Monkey create a "trinity of harmony."</li>
                            <li><strong>Six Harmonies (六合):</strong> Signs six years apart form balanced partnerships.
                                <br>Example: Rat with Ox, Tiger with Pig.</li>
                            <li><strong>Opposites (相冲):</strong> Signs six positions apart may experience relationship tension.
                                <br>Example: Rat with Horse, Ox with Sheep.</li>
                            <li><strong>Penalties (相刑):</strong> Certain signs naturally present relationship challenges.
                                <br>Example: Dragon with Dog, Snake with Pig.</li>
                        </ul>
                        
                        <h4>Zodiac Personality Traits</h4>
                        <p>Each zodiac sign represents different personality characteristics:</p>
                        <div class="zodiac-grid">
                            <div class="zodiac-item"><strong>Rat:</strong> The "Prosperity Guardian" - clever and resourceful</div>
                            <div class="zodiac-item"><strong>Ox:</strong> The "Steadfast Protector" - determined and reliable</div>
                            <div class="zodiac-item"><strong>Tiger:</strong> The "Royal Warrior" - brave and commanding</div>
                            <div class="zodiac-item"><strong>Rabbit:</strong> The "Moonlight Enchanter" - gentle and romantic</div>
                            <div class="zodiac-item"><strong>Dragon:</strong> The "Celestial Heir" - charismatic and powerful</div>
                            <div class="zodiac-item"><strong>Snake:</strong> The "Wisdom Keeper" - insightful and mysterious</div>
                            <div class="zodiac-item"><strong>Horse:</strong> The "Prairie Spirit" - energetic and free-spirited</div>
                            <div class="zodiac-item"><strong>Goat:</strong> The "Artistic Soul" - creative and compassionate</div>
                            <div class="zodiac-item"><strong>Monkey:</strong> The "Clever Trickster" - versatile and witty</div>
                            <div class="zodiac-item"><strong>Rooster:</strong> The "Time Guardian" - meticulous and precise</div>
                            <div class="zodiac-item"><strong>Dog:</strong> The "Loyal Defender" - faithful and protective</div>
                            <div class="zodiac-item"><strong>Pig:</strong> The "Happiness Ambassador" - generous and optimistic</div>
                        </div>
                    </div>
                    
                    <div class="bazi-info">
                        <h3>BaZi - The Celestial Book of Fate</h3>
                        <p>BaZi, also known as "Four Pillars," is a destiny calculation system based on a person's birth year, month, day, and hour. BaZi matching provides a more comprehensive analysis including the Five Elements theory, like a cosmic bond carefully woven by the universe for each pair of lovers.</p>
                        
                        <h4>Five Elements Relationships</h4>
                        <p>The core concept of BaZi matching is the interaction between the Five Elements:</p>
                        <ul>
                            <li><strong>Generating Cycle:</strong> 
                                <br>Wood → Fire → Earth → Metal → Water → Wood
                                <br><em>(Each element creates or nourishes the next)</em>
                            </li>
                            <li><strong>Controlling Cycle:</strong> 
                                <br>Wood ⊣ Earth ⊣ Water ⊣ Fire ⊣ Metal ⊣ Wood
                                <br><em>(Each element controls or restricts another)</em>
                            </li>
                        </ul>
                        
                        <h4>BaZi Matching Elements</h4>
                        <p>BaZi matching considers more than just zodiac signs, analyzing:</p>
                        <div class="bazi-factors">
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Day Master's Element</strong></div>
                                <div class="factor-desc">The core of your chart, determining your dominant personality in relationships</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Year Pillar's Branch</strong></div>
                                <div class="factor-desc">Reflects your family background and social influence - the "match made in heaven" factor</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Hour Pillar's Branch</strong></div>
                                <div class="factor-desc">Your inner qualities and desires, determining your relationship's long-term potential</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Birth Year's Element</strong></div>
                                <div class="factor-desc">Your innate energy attributes, influencing compatibility and conflicts in your relationship</div>
                            </div>
                        </div>
                        
                        <h4>Marriage Compatibility Assessment</h4>
                        <p>Traditional BaZi marriage matching primarily examines:</p>
                        <div class="bazi-factors">
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Three Talents Configuration</strong></div>
                                <div class="factor-desc">Perfect harmony of Heaven, Earth, and Human factors - determining the strength and destiny of your connection</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Five Elements Balance</strong></div>
                                <div class="factor-desc">The complementary harmony of your energy fields, like yin and yang blending in perfect unity</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Special Combinations</strong></div>
                                <div class="factor-desc">Rare destiny patterns that might indicate a "fated connection" written in the stars</div>
                            </div>
                            <div class="bazi-factor">
                                <div class="factor-title"><strong>Fortune Cycles</strong></div>
                                <div class="factor-desc">The ups and downs of destiny and mutual growth - a love journey filled with both challenges and opportunities</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Note: This website is for entertainment purposes only. Please don't use the results as a basis for important decisions. True love and mutual understanding are the keys to any relationship.</p>
            <p>&copy; <script>document.write(new Date().getFullYear())</script> <a href="https://loversmatchs.org" style="color: var(--apple-blue); text-decoration: none;">loversmatchs.org</a> All Rights Reserved.</p>
        </footer>
    </div>
    
    <!-- 添加Chart.js库 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- 使用普通脚本，手动实现BaziConverter -->
    <script>
        // 简化版的BaziConverter实现，用于计算八字
        // 这是一个基于常见算法的简化版本，不如专业库精确，但可以满足基本需求
        class SimpleBaziConverter {
            constructor(year, month, day, hour) {
                this.year = year;
                this.month = month + 1; // 转回1-12月
                this.day = day;
                this.hour = hour;
                this.baziData = this.calculate();
            }
            
            calculate() {
                // 天干映射
                const heavenlyStems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                // 地支映射
                const earthlyBranches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                // 时辰地支映射
                const hourToBranch = [
                    '子', '子', '丑', '丑', '寅', '寅', '卯', '卯', '辰', '辰', '巳', '巳',
                    '午', '午', '未', '未', '申', '申', '酉', '酉', '戌', '戌', '亥', '亥'
                ];
                
                // 年干支计算 (以立春为界)
                const yearOffset = (this.year - 4) % 60;
                const yearStem = heavenlyStems[yearOffset % 10];
                const yearBranch = earthlyBranches[yearOffset % 12];
                
                // 月干支计算 (以节气为界，这里简化处理)
                // 月干 = 年干*2 + 月支索引，然后取余10
                const monthIndex = this.month - 1;
                const yearStemIndex = heavenlyStems.indexOf(yearStem);
                const monthStemIndex = (yearStemIndex * 2 + monthIndex) % 10;
                const monthStem = heavenlyStems[monthStemIndex];
                const monthBranch = earthlyBranches[(monthIndex + 2) % 12];
                
                // 日干支计算 (使用公式)
                // 1900年1月31日是甲辰日
                const baseDate = new Date(1900, 0, 31);
                const currentDate = new Date(this.year, this.month - 1, this.day);
                const dayDiff = Math.floor((currentDate - baseDate) / (24 * 60 * 60 * 1000));
                const dayStemIndex = dayDiff % 10;
                const dayBranchIndex = dayDiff % 12;
                const dayStem = heavenlyStems[dayStemIndex];
                const dayBranch = earthlyBranches[dayBranchIndex];
                
                // 时干支计算
                // 时干 = (日干索引*2 + 时辰索引/2) % 10
                const hourBranchIndex = this.hour >= 0 && this.hour < 24 ? this.hour : 12;
                const hourBranch = hourToBranch[hourBranchIndex];
                const hourBranchIdx = earthlyBranches.indexOf(hourBranch);
                const hourStemIndex = (dayStemIndex * 2 + Math.floor(hourBranchIdx / 2)) % 10;
                const hourStem = heavenlyStems[hourStemIndex];
                
                return {
                    year: yearStem + yearBranch,
                    month: monthStem + monthBranch,
                    day: dayStem + dayBranch,
                    time: hourStem + hourBranch
                };
            }
            
            getBaziJson() {
                return this.baziData;
            }
        }
        
        // 全局暴露这个类，使其可以在原有代码中使用
        window.BaziConverter = SimpleBaziConverter;
        
        // 生肖配对数据
        const zodiacCompatibility = {
            // 鼠
            '鼠': {
                '鼠': 80, '牛': 90, '虎': 60, '兔': 60, '龙': 95, '蛇': 60,
                '马': 30, '羊': 40, '猴': 95, '鸡': 60, '狗': 65, '猪': 80
            },
            // 牛
            '牛': {
                '鼠': 90, '牛': 70, '虎': 30, '兔': 65, '龙': 40, '蛇': 90,
                '马': 40, '羊': 20, '猴': 60, '鸡': 90, '狗': 70, '猪': 60
            },
            // 虎
            '虎': {
                '鼠': 60, '牛': 30, '虎': 50, '兔': 85, '龙': 85, '蛇': 40,
                '马': 90, '羊': 60, '猴': 30, '鸡': 50, '狗': 95, '猪': 90
            },
            // 兔
            '兔': {
                '鼠': 60, '牛': 65, '虎': 85, '兔': 75, '龙': 60, '蛇': 40,
                '马': 60, '羊': 90, '猴': 70, '鸡': 30, '狗': 90, '猪': 95
            },
            // 龙
            '龙': {
                '鼠': 95, '牛': 40, '虎': 85, '兔': 60, '龙': 70, '蛇': 80,
                '马': 70, '羊': 50, '猴': 90, '鸡': 85, '狗': 30, '猪': 65
            },
            // 蛇
            '蛇': {
                '鼠': 60, '牛': 90, '虎': 40, '兔': 40, '龙': 80, '蛇': 70,
                '马': 60, '羊': 70, '猴': 60, '鸡': 95, '狗': 60, '猪': 30
            },
            // 马
            '马': {
                '鼠': 30, '牛': 40, '虎': 90, '兔': 60, '龙': 70, '蛇': 60,
                '马': 50, '羊': 90, '猴': 70, '鸡': 40, '狗': 90, '猪': 60
            },
            // 羊
            '羊': {
                '鼠': 40, '牛': 20, '虎': 60, '兔': 90, '龙': 50, '蛇': 70,
                '马': 90, '羊': 70, '猴': 60, '鸡': 70, '狗': 40, '猪': 90
            },
            // 猴
            '猴': {
                '鼠': 95, '牛': 60, '虎': 30, '兔': 70, '龙': 90, '蛇': 60,
                '马': 70, '羊': 60, '猴': 80, '鸡': 70, '狗': 80, '猪': 40
            },
            // 鸡
            '鸡': {
                '鼠': 60, '牛': 90, '虎': 50, '兔': 30, '龙': 85, '蛇': 95,
                '马': 40, '羊': 70, '猴': 70, '鸡': 60, '狗': 40, '猪': 70
            },
            // 狗
            '狗': {
                '鼠': 65, '牛': 70, '虎': 95, '兔': 90, '龙': 30, '蛇': 60,
                '马': 90, '羊': 40, '猴': 80, '鸡': 40, '狗': 70, '猪': 85
            },
            // 猪
            '猪': {
                '鼠': 80, '牛': 60, '虎': 90, '兔': 95, '龙': 65, '蛇': 30,
                '马': 60, '羊': 90, '猴': 40, '鸡': 70, '狗': 85, '猪': 75
            }
        };

        // 五行配对数据
        const fiveElementsCompatibility = {
            '金': { '金': 70, '木': 40, '水': 90, '火': 30, '土': 80 },
            '木': { '金': 40, '木': 70, '水': 85, '火': 90, '土': 50 },
            '水': { '金': 90, '木': 85, '水': 70, '火': 40, '土': 30 },
            '火': { '金': 30, '木': 90, '水': 40, '火': 70, '土': 80 },
            '土': { '金': 80, '木': 50, '水': 30, '火': 80, '土': 70 }
        };

        // 生肖与出生年份对应表
        const zodiacYears = {
            '鼠': [1924, 1936, 1948, 1960, 1972, 1984, 1996, 2008, 2020],
            '牛': [1925, 1937, 1949, 1961, 1973, 1985, 1997, 2009, 2021],
            '虎': [1926, 1938, 1950, 1962, 1974, 1986, 1998, 2010, 2022],
            '兔': [1927, 1939, 1951, 1963, 1975, 1987, 1999, 2011, 2023],
            '龙': [1928, 1940, 1952, 1964, 1976, 1988, 2000, 2012, 2024],
            '蛇': [1929, 1941, 1953, 1965, 1977, 1989, 2001, 2013, 2025],
            '马': [1930, 1942, 1954, 1966, 1978, 1990, 2002, 2014, 2026],
            '羊': [1931, 1943, 1955, 1967, 1979, 1991, 2003, 2015, 2027],
            '猴': [1932, 1944, 1956, 1968, 1980, 1992, 2004, 2016, 2028],
            '鸡': [1933, 1945, 1957, 1969, 1981, 1993, 2005, 2017, 2029],
            '狗': [1934, 1946, 1958, 1970, 1982, 1994, 2006, 2018, 2030],
            '猪': [1935, 1947, 1959, 1971, 1983, 1995, 2007, 2019, 2031]
        };

        // 年份与五行对应表
        const yearElement = {
            0: '金', 1: '金', 
            2: '水', 3: '水', 
            4: '木', 5: '木', 
            6: '火', 7: '火', 
            8: '土', 9: '土'
        };

        // 天干地支与五行
        const heavenlyStems = {
            '甲': { element: '木', type: '阳' }, '乙': { element: '木', type: '阴' },
            '丙': { element: '火', type: '阳' }, '丁': { element: '火', type: '阴' },
            '戊': { element: '土', type: '阳' }, '己': { element: '土', type: '阴' },
            '庚': { element: '金', type: '阳' }, '辛': { element: '金', type: '阴' },
            '壬': { element: '水', type: '阳' }, '癸': { element: '水', type: '阴' }
        };

        const earthlyBranches = {
            '子': { element: '水', animal: '鼠' }, '丑': { element: '土', animal: '牛' },
            '寅': { element: '木', animal: '虎' }, '卯': { element: '木', animal: '兔' },
            '辰': { element: '土', animal: '龙' }, '巳': { element: '火', animal: '蛇' },
            '午': { element: '火', animal: '马' }, '未': { element: '土', animal: '羊' },
            '申': { element: '金', animal: '猴' }, '酉': { element: '金', animal: '鸡' },
            '戌': { element: '土', animal: '狗' }, '亥': { element: '水', animal: '猪' }
        };

        // 日期与生肖对应
        function getZodiac(year) {
            for (const [zodiac, years] of Object.entries(zodiacYears)) {
                if (years.includes(year)) {
                    return zodiac;
                }
            }
            // 如果没有直接匹配，计算生肖
            const base = (year - 4) % 12;
            const zodiacArray = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
            return zodiacArray[base];
        }
        
        // 中文生肖翻译成英文
        function translateZodiac(chineseZodiac) {
            const translations = {
                '鼠': 'Rat',
                '牛': 'Ox',
                '虎': 'Tiger',
                '兔': 'Rabbit',
                '龙': 'Dragon',
                '蛇': 'Snake',
                '马': 'Horse',
                '羊': 'Goat',
                '猴': 'Monkey',
                '鸡': 'Rooster',
                '狗': 'Dog',
                '猪': 'Pig'
            };
            return translations[chineseZodiac] || chineseZodiac;
        }

        // 获取五行属性
        function getElement(year) {
            const lastDigit = year % 10;
            return yearElement[lastDigit];
        }
        
        // 中文五行翻译成英文
        function translateElement(chineseElement) {
            const translations = {
                '金': 'Metal',
                '木': 'Wood',
                '水': 'Water',
                '火': 'Fire',
                '土': 'Earth'
            };
            return translations[chineseElement] || chineseElement;
        }

        // 初始化日期选择器
        function initDateSelectors() {
            const currentYear = new Date().getFullYear();
            
            // 优化1：减少初始年份范围，只显示最近50年而不是100年
            const startYear = currentYear - 50;
            const endYear = currentYear;
            
            // 优化2：使用DocumentFragment减少DOM操作
            const yearSelectors = [document.getElementById('year1'), document.getElementById('year2')];
            yearSelectors.forEach(selector => {
                const fragment = document.createDocumentFragment();
                for (let i = startYear; i <= endYear; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    if (i === currentYear - 30) option.selected = true;
                    fragment.appendChild(option);
                }
                selector.appendChild(fragment);
            });
            
            // 月份选择器 - 同样使用DocumentFragment优化
            const monthSelectors = [document.getElementById('month1'), document.getElementById('month2')];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            monthSelectors.forEach(selector => {
                const fragment = document.createDocumentFragment();
                for (let i = 1; i <= 12; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = monthNames[i-1];
                    fragment.appendChild(option);
                }
                selector.appendChild(fragment);
            });
            
            // 日期选择器
            updateDayOptions('month1', 'year1', 'day1');
            updateDayOptions('month2', 'year2', 'day2');
            
            // 小时选择器 - 同样使用DocumentFragment优化
            const hourSelectors = [document.getElementById('hour1'), document.getElementById('hour2')];
            const hours = [
                { value: -1, text: 'Unknown (optional)' },
                { value: 0, text: '23:00 - 00:59 (子時 Rat)' },
                { value: 1, text: '01:00 - 02:59 (丑時 Ox)' },
                { value: 2, text: '03:00 - 04:59 (寅時 Tiger)' },
                { value: 3, text: '05:00 - 06:59 (卯時 Rabbit)' },
                { value: 4, text: '07:00 - 08:59 (辰時 Dragon)' },
                { value: 5, text: '09:00 - 10:59 (巳時 Snake)' },
                { value: 6, text: '11:00 - 12:59 (午時 Horse)' },
                { value: 7, text: '13:00 - 14:59 (未時 Goat)' },
                { value: 8, text: '15:00 - 16:59 (申時 Monkey)' },
                { value: 9, text: '17:00 - 18:59 (酉時 Rooster)' },
                { value: 10, text: '19:00 - 20:59 (戌時 Dog)' },
                { value: 11, text: '21:00 - 22:59 (亥時 Pig)' }
            ];

            hourSelectors.forEach(selector => {
                const fragment = document.createDocumentFragment();
                hours.forEach(hour => {
                    const option = document.createElement('option');
                    option.value = hour.value;
                    option.textContent = hour.text;
                    fragment.appendChild(option);
                });
                selector.appendChild(fragment);
            });
            
            // 添加事件监听器
            document.getElementById('month1').addEventListener('change', () => updateDayOptions('month1', 'year1', 'day1'));
            document.getElementById('year1').addEventListener('change', () => updateDayOptions('month1', 'year1', 'day1'));
            document.getElementById('month2').addEventListener('change', () => updateDayOptions('month2', 'year2', 'day2'));
            document.getElementById('year2').addEventListener('change', () => updateDayOptions('month2', 'year2', 'day2'));
        }

        // 更新日期选择器 - 同样使用DocumentFragment优化
        function updateDayOptions(monthId, yearId, dayId) {
            const month = parseInt(document.getElementById(monthId).value);
            const year = parseInt(document.getElementById(yearId).value);
            const daySelect = document.getElementById(dayId);
            
            // 清空现有选项
            daySelect.innerHTML = '';
            
            // 计算当月天数
            let daysInMonth;
            if ([4, 6, 9, 11].includes(month)) {
                daysInMonth = 30;
            } else if (month === 2) {
                daysInMonth = ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0) ? 29 : 28;
            } else {
                daysInMonth = 31;
            }
            
            // 使用DocumentFragment添加选项
            const fragment = document.createDocumentFragment();
            for (let i = 1; i <= daysInMonth; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                fragment.appendChild(option);
            }
            daySelect.appendChild(fragment);
        }

        // MBTI 匹配度计算函数
        function calculateMbtiCompatibility() {
            const mbti1 = document.getElementById('mbti1').value;
            const mbti2 = document.getElementById('mbti2').value;
            
            if (!mbti1 || !mbti2) {
                alert('Please select both MBTI types');
                return;
            }
            
            // Analyze four dimensions of compatibility
            const dimensions = [
                { name: 'E/I', index: 0, label: 'Extraversion vs Introversion' },
                { name: 'S/N', index: 1, label: 'Sensing vs Intuition' },
                { name: 'T/F', index: 2, label: 'Thinking vs Feeling' },
                { name: 'J/P', index: 3, label: 'Judging vs Perceiving' }
            ];
            
            let compatibilityAnalysis = [];
            let totalCompatibilityScore = 0;
            
            dimensions.forEach(dim => {
                const char1 = mbti1[dim.index];
                const char2 = mbti2[dim.index];
                
                let compatibility, description, points;
                
                if (char1 === char2) {
                    compatibility = 'Highly Compatible';
                    points = 3;
                    description = getDimensionSameDescription(dim.name, char1);
                } else {
                    compatibility = 'Complementary Balance';
                    points = 2;
                    description = getDimensionOppositeDescription(dim.name, char1, char2);
                }
                
                totalCompatibilityScore += points;
                
                compatibilityAnalysis.push({
                    dimension: dim.label,
                    compatibility,
                    description,
                    points
                });
            });
            
            // Calculate overall compatibility level
            let overallCompatibility, overallDescription, advice;
            
            if (totalCompatibilityScore >= 11) {
                overallCompatibility = 'Exceptionally Compatible';
                overallDescription = 'Your personality types are exceptionally well-matched, with many shared traits that enable deep understanding of each other\'s thoughts and feelings.';
                advice = 'Maintain open communication and cherish this rare mental connection. Seek growth opportunities within your similarities.';
            } else if (totalCompatibilityScore >= 9) {
                overallCompatibility = 'Highly Compatible';
                overallDescription = 'Your personality types are highly compatible, sharing common ground while offering complementary aspects that foster mutual growth.';
                advice = 'Leverage your similarities to build deep connections while appreciating the fresh perspectives your differences bring.';
            } else if (totalCompatibilityScore >= 7) {
                overallCompatibility = 'Moderately Compatible';
                overallDescription = 'Your relationship requires more understanding and communication, but these differences make the relationship more interesting and full of growth opportunities.';
                advice = 'Communicate more about thoughts and feelings, and learn to appreciate different ways of thinking. Patience is key.';
            } else {
                overallCompatibility = 'Requires Understanding';
                overallDescription = 'Your personality types have significant differences, requiring more understanding, patience, and communication to build a harmonious relationship.';
                advice = 'Focus on finding common ground and respecting differences. Use open dialogue to resolve potential conflicts.';
            }
            
            // 显示 MBTI 结果
            displayMbtiResults(mbti1, mbti2, compatibilityAnalysis, overallCompatibility, overallDescription, advice);
        }
        
        // Get description for same dimension preferences
        function getDimensionSameDescription(dimension, char) {
            const descriptions = {
                'E': 'Both of you are extraverted, enjoying social interaction and communication. You can mutually support and understand each other in social environments.',
                'I': 'Both of you are introverted, preferring quiet environments and deep reflection. You can enjoy each other\'s company without needing much external stimulation.',
                'S': 'Both of you are sensing types, focusing on reality and details. You\'ll have great harmony when handling practical matters.',
                'N': 'Both of you are intuitive types, enjoying exploring possibilities and innovative ideas. You can resonate on dreams and future planning.',
                'T': 'Both of you are thinking types, valuing logic and objective analysis. You can maintain rationality and consistency in decision-making.',
                'F': 'Both of you are feeling types, valuing relationships and personal values. You can deeply understand each other\'s emotional needs.',
                'J': 'Both of you are judging types, preferring planning and structure. You\'ll have great harmony in life arrangements and decision-making.',
                'P': 'Both of you are perceiving types, enjoying flexibility and spontaneity. You can together embrace life\'s uncertainties and surprises.'
            };
            return descriptions[char] || 'You share similar preferences in this dimension.';
        }
        
        // Get description for opposite dimension preferences
        function getDimensionOppositeDescription(dimension, char1, char2) {
            const descriptions = {
                'E-I': char1 === 'E' ? 
                    'One extraverted, one introverted - the extraverted partner brings social energy while the introverted partner provides quiet reflection space, creating excellent balance.' :
                    'One introverted, one extraverted - the introverted partner provides deep thinking while the extraverted partner brings social vitality, complementing each other perfectly.',
                'S-N': char1 === 'S' ? 
                    'One focused on reality, one imaginative - the realist provides stable foundation while the idealist brings innovative thinking.' :
                    'One imaginative, one focused on reality - the idealist provides creative perspectives while the realist ensures practical implementation.',
                'T-F': char1 === 'T' ? 
                    'One rational, one emotional - the rational partner provides objective analysis while the emotional partner brings warmth, forming an ideal decision-making combination.' :
                    'One emotional, one rational - the emotional partner provides feeling support while the rational partner brings objective thinking, balancing each other.',
                'J-P': char1 === 'J' ? 
                    'One prefers planning, one prefers flexibility - the planner provides structure and stability while the flexible one brings surprises and variety.' :
                    'One prefers flexibility, one prefers planning - the flexible one provides life\'s excitement while the planner ensures goal achievement.'
            };
            const key = dimension === 'E/I' ? 'E-I' : dimension === 'S/N' ? 'S-N' : dimension === 'T/F' ? 'T-F' : 'J-P';
            return descriptions[key] || 'You form excellent complementarity in this dimension.';
        }
        
        // 显示 MBTI 结果
        function displayMbtiResults(mbti1, mbti2, analysis, overall, description, advice) {
            const resultSection = document.getElementById('mbti-result-section');
            
            let analysisHtml = '';
            analysis.forEach(item => {
                analysisHtml += `
                    <div class="compatibility-item">
                        <h4>${item.dimension}</h4>
                        <p><strong>Compatibility:</strong> ${item.compatibility}</p>
                        <p>${item.description}</p>
                    </div>
                `;
            });
            
            resultSection.innerHTML = `
                <div class="result-header">
                    <h3>MBTI Compatibility Analysis Results</h3>
                    <div class="mbti-types">
                        <span class="mbti-type">${mbti1}</span>
                        <span class="vs">💕</span>
                        <span class="mbti-type">${mbti2}</span>
                    </div>
                </div>
                
                <div class="overall-compatibility">
                    <h4>Overall Compatibility: ${overall}</h4>
                    <p>${description}</p>
                </div>
                
                <div class="compatibility-details">
                    ${analysisHtml}
                </div>
                
                <div class="relationship-advice">
                    <h4>Relationship Advice</h4>
                    <p>${advice}</p>
                </div>
            `;
            
            resultSection.classList.add('active');
        }
        
        // 界面切换函数
        function switchToMode(mode) {
            const baziBtn = document.getElementById('bazi-mode-btn');
            const mbtiBtn = document.getElementById('mbti-mode-btn');
            const baziCalculator = document.getElementById('bazi-calculator');
            const mbtiCalculator = document.getElementById('mbti-calculator');
            
            if (mode === 'bazi') {
                baziBtn.classList.add('active');
                mbtiBtn.classList.remove('active');
                baziCalculator.style.display = 'block';
                mbtiCalculator.style.display = 'none';
            } else if (mode === 'mbti') {
                mbtiBtn.classList.add('active');
                baziBtn.classList.remove('active');
                mbtiCalculator.style.display = 'block';
                baziCalculator.style.display = 'none';
            }
        }

        // 计算配对得分
        function calculateCompatibility() {
            // 获取输入的日期
            const year1 = parseInt(document.getElementById('year1').value);
            const month1 = parseInt(document.getElementById('month1').value);
            const day1 = parseInt(document.getElementById('day1').value);
            const hour1 = parseInt(document.getElementById('hour1').value);

            const year2 = parseInt(document.getElementById('year2').value);
            const month2 = parseInt(document.getElementById('month2').value);
            const day2 = parseInt(document.getElementById('day2').value);
            const hour2 = parseInt(document.getElementById('hour2').value);
            
            // 使用传统方法获取生肖和五行（作为备用）
            const traditionalZodiac1 = getZodiac(year1);
            const traditionalZodiac2 = getZodiac(year2);
            const traditionalElement1 = getElement(year1);
            const traditionalElement2 = getElement(year2);
            
            // 使用 bazi-converter 获取八字信息
            let baziJson1, baziJson2;
            let dayMaster1, dayMaster2;
            let zodiac1, zodiac2;
            
            try {
                // 注意：月份需要-1，因为库是0-11索引
                // 时辰不详时传入12（中午），作为一个中性时间
                const bazi1 = new BaziConverter(year1, month1 - 1, day1, hour1 === -1 ? 12 : hour1 * 2);
                const bazi2 = new BaziConverter(year2, month2 - 1, day2, hour2 === -1 ? 12 : hour2 * 2);
                
                baziJson1 = bazi1.getBaziJson();
                baziJson2 = bazi2.getBaziJson();
                
                // 获取日主（日柱天干）
                dayMaster1 = baziJson1.day.substring(0, 1);
                dayMaster2 = baziJson2.day.substring(0, 1);
                
                // 从年柱地支获取生肖
                zodiac1 = earthlyBranches[baziJson1.year.substring(1)].animal;
                zodiac2 = earthlyBranches[baziJson2.year.substring(1)].animal;
            } catch (error) {
                console.error("八字计算出错，回退到传统方法:", error);
                // 如果八字计算出错，回退到传统方法
                zodiac1 = traditionalZodiac1;
                zodiac2 = traditionalZodiac2;
                dayMaster1 = null;
                dayMaster2 = null;
            }
            
            // --- 评分模型 ---
            let dayMasterScore = 0;
            let fiveElementsBalanceScore = 0;
            
            // 1. 生肖配对得分
            const zodiacScore = zodiacCompatibility[zodiac1][zodiac2];
            
            // 2. 五行配对得分
            const elementScore = fiveElementsCompatibility[traditionalElement1][traditionalElement2];
            
            // 3. 日主配对得分 (如果八字计算成功)
            if (dayMaster1 && dayMaster2) {
                const dayMasterElement1 = heavenlyStems[dayMaster1].element;
                const dayMasterElement2 = heavenlyStems[dayMaster2].element;
                dayMasterScore = fiveElementsCompatibility[dayMasterElement1][dayMasterElement2];
                
                // 4. 五行平衡得分
                fiveElementsBalanceScore = calculateFiveElementsBalance(baziJson1, baziJson2);
            } else {
                // 如果没有八字，使用传统方法的替代评分
                dayMasterScore = 70; // 默认中等分数
                fiveElementsBalanceScore = 60; // 默认稍低分数
            }
            
            // 计算日期和月份因素 (简化版)
            const monthDiff = Math.abs(month1 - month2);
            let monthCompatibility = 70;
            if (monthDiff === 0) {
                monthCompatibility = 85; // 同月出生
            } else if (monthDiff === 6) {
                monthCompatibility = 60; // 相对月份
            } else if (monthDiff === 3 || monthDiff === 9) {
                monthCompatibility = 75; // 季节关系
            }
            
            // 日期相合度
            const dayDiff = Math.abs(day1 - day2);
            let dayCompatibility = 70;
            if (dayDiff === 0) {
                dayCompatibility = 85; // 同日出生
            } else if (dayDiff <= 3) {
                dayCompatibility = 80; // 接近的日期
            } else if (dayDiff >= 15) {
                dayCompatibility = 65; // 相距较远的日期
            }
            
            // 综合得分计算 - 根据是否有八字信息调整权重
            let totalScore;
            if (dayMaster1 && dayMaster2) {
                // 有八字信息时的权重分配
                totalScore = Math.round(
                    (dayMasterScore * 0.4) +       // 日主权重40%
                    (zodiacScore * 0.2) +          // 生肖权重20%
                    (elementScore * 0.1) +         // 五行权重10%
                    (fiveElementsBalanceScore * 0.2) + // 五行平衡权重20%
                    (monthCompatibility * 0.05) +  // 月份权重5%
                    (dayCompatibility * 0.05)      // 日期权重5%
                );
            } else {
                // 没有八字信息时的传统权重
                totalScore = Math.round(
                    (zodiacScore * 0.4) +          // 生肖权重40%
                    (elementScore * 0.3) +         // 五行权重30%
                    (monthCompatibility * 0.15) +  // 月份权重15%
                    (dayCompatibility * 0.15)      // 日期权重15%
                );
            }
            
            // 展示结果
            displayResults(
                zodiac1, zodiac2, 
                traditionalElement1, traditionalElement2, 
                zodiacScore, elementScore, 
                dayMasterScore, fiveElementsBalanceScore, 
                monthCompatibility, dayCompatibility, 
                totalScore, 
                baziJson1, baziJson2
            );
        }
        
        // 计算五行平衡得分
        function calculateFiveElementsBalance(baziJson1, baziJson2) {
            // 初始化五行计数器
            const elements1 = { '金': 0, '木': 0, '水': 0, '火': 0, '土': 0 };
            const elements2 = { '金': 0, '木': 0, '水': 0, '火': 0, '土': 0 };
            
            // 统计八字1的五行
            for (const pillar of ['year', 'month', 'day', 'time']) {
                if (baziJson1[pillar]) {
                    const stem = baziJson1[pillar].substring(0, 1);
                    const branch = baziJson1[pillar].substring(1);
                    
                    if (heavenlyStems[stem]) {
                        elements1[heavenlyStems[stem].element]++;
                    }
                    
                    if (earthlyBranches[branch]) {
                        elements1[earthlyBranches[branch].element]++;
                    }
                }
            }
            
            // 统计八字2的五行
            for (const pillar of ['year', 'month', 'day', 'time']) {
                if (baziJson2[pillar]) {
                    const stem = baziJson2[pillar].substring(0, 1);
                    const branch = baziJson2[pillar].substring(1);
                    
                    if (heavenlyStems[stem]) {
                        elements2[heavenlyStems[stem].element]++;
                    }
                    
                    if (earthlyBranches[branch]) {
                        elements2[earthlyBranches[branch].element]++;
                    }
                }
            }
            
            // 计算互补性得分
            let balanceScore = 50; // 基础分
            
            // 检查五行互补
            for (const element of ['金', '木', '水', '火', '土']) {
                // 如果一方缺少某五行，而另一方该五行多，则加分
                if (elements1[element] === 0 && elements2[element] >= 2) {
                    balanceScore += 10;
                }
                if (elements2[element] === 0 && elements1[element] >= 2) {
                    balanceScore += 10;
                }
                
                // 如果双方都有相同五行，也加少量分
                if (elements1[element] > 0 && elements2[element] > 0) {
                    balanceScore += 2;
                }
            }
            
            // 最高不超过100
            return Math.min(balanceScore, 100);
        }

        // 显示结果
        function displayResults(
            zodiac1, zodiac2, 
            element1, element2, 
            zodiacScore, elementScore, 
            dayMasterScore, balanceScore, 
            monthScore, dayScore, 
            totalScore, 
            baziJson1, baziJson2
        ) {
            const resultSection = document.getElementById('result-section');
            
            // 基于总分的评价
            let scoreComment = '';
            if (totalScore >= 90) {
                scoreComment = 'A match made in heaven! Your connection seems divinely arranged, with an irresistible magnetic attraction that promises an extraordinarily happy future together.';
            } else if (totalScore >= 80) {
                scoreComment = 'Perfect partners! Your relationship is harmonious and stable, with aligned values and remarkable chemistry that will create a beautiful life together.';
            } else if (totalScore >= 70) {
                scoreComment = 'Wonderfully matched! Despite occasional differences, you naturally get along harmoniously, understanding each other like fish to water.';
            } else if (totalScore >= 60) {
                scoreComment = 'Destined companions! Your relationship has challenges but also delightful surprises - with heartfelt communication, you will overcome difficulties and elevate each other.';
            } else if (totalScore >= 50) {
                scoreComment = 'A relationship worth nurturing. Your meeting is fated, but your journey requires deeper understanding and acceptance, with mutual effort to maintain your bond.';
            } else {
                scoreComment = 'A unique connection. You may have significant differences in many aspects, but true love can transcend all obstacles - with extra dedication, you might create an unexpected miracle together.';
            }
            
                         // 设置圆环进度条百分比
            const scorePercentage = `${totalScore}%`;
            
            // 创建结果HTML
            resultSection.innerHTML = `
                <div class="result-header">
                    <h3>Compatibility Results</h3>
                    <p>Comprehensive analysis based on Chinese Zodiac & BaZi</p>
                </div>
                
                <div class="compatibility-score" style="--score: ${scorePercentage}">
                    <div class="score-text">${totalScore}</div>
                </div>
                
                <p class="score-comment">${scoreComment}</p>
                
                <div class="compatibility-details">
                    ${baziJson1 && baziJson2 ? `
                    <div class="compatibility-item">
                        <h4>Core Match (Day Master)</h4>
                        <p>Your core element: <strong>${translateElement(heavenlyStems[baziJson1.day.substring(0, 1)].element)}</strong>, your partner's: <strong>${translateElement(heavenlyStems[baziJson2.day.substring(0, 1)].element)}</strong></p>
                        <p>Core harmony score: <strong>${dayMasterScore}</strong>/100</p>
                        <p>${getElementCompatibilityComment(heavenlyStems[baziJson1.day.substring(0, 1)].element, heavenlyStems[baziJson2.day.substring(0, 1)].element)}</p>
                    </div>
                    ` : ''}

                    <div class="compatibility-item">
                        <h4>Zodiac Compatibility</h4>
                        <p>You are a <strong>${translateZodiac(zodiac1)}</strong>, your partner is a <strong>${translateZodiac(zodiac2)}</strong></p>
                        <p>Zodiac harmony score: <strong>${zodiacScore}</strong>/100</p>
                        <p>${getZodiacCompatibilityComment(zodiacScore)}</p>
                    </div>
                    
                    <div class="compatibility-item">
                        <h4>Five Elements Compatibility</h4>
                        <p>Your element is <strong>${translateElement(element1)}</strong>, your partner's element is <strong>${translateElement(element2)}</strong></p>
                        <p>Element harmony score: <strong>${elementScore}</strong>/100</p>
                        <p>${getElementCompatibilityComment(element1, element2)}</p>
                    </div>
                    
                    ${baziJson1 && baziJson2 ? `
                    <div class="compatibility-item">
                        <h4>Five Elements Balance</h4>
                        <p>Analyzes how your elemental energies complement each other.</p>
                        <p>Balance score: <strong>${balanceScore}</strong>/100</p>
                    </div>
                    ` : `
                    <div class="compatibility-item">
                        <h4>Date Factors</h4>
                        <p>Month compatibility: <strong>${monthScore}</strong>/100</p>
                        <p>Day compatibility: <strong>${dayScore}</strong>/100</p>
                    </div>
                    `}
                </div>
                
                ${baziJson1 && baziJson2 ? `
                <div class="bazi-charts">
                    <h4>Your BaZi Charts</h4>
                    <div class="chart-container">
                        <div class="bazi-chart">
                            <div class="chart-wrapper">
                                <canvas id="fiveElementsChart1"></canvas>
                            </div>
                            <h5>Your BaZi Chart</h5>
                            <div class="bazi-pillars">
                                <div class="pillar">
                                    <div class="stem">${baziJson1.year.substring(0, 1)}</div>
                                    <div class="branch">${baziJson1.year.substring(1)}</div>
                                    <div class="label">Year</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson1.month.substring(0, 1)}</div>
                                    <div class="branch">${baziJson1.month.substring(1)}</div>
                                    <div class="label">Month</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson1.day.substring(0, 1)}</div>
                                    <div class="branch">${baziJson1.day.substring(1)}</div>
                                    <div class="label">Day</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson1.time.substring(0, 1)}</div>
                                    <div class="branch">${baziJson1.time.substring(1)}</div>
                                    <div class="label">Hour</div>
                                </div>
                            </div>
                        </div>
                        <div class="bazi-chart">
                            <div class="chart-wrapper">
                                <canvas id="fiveElementsChart2"></canvas>
                            </div>
                            <h5>Your Partner's BaZi Chart</h5>
                            <div class="bazi-pillars">
                                <div class="pillar">
                                    <div class="stem">${baziJson2.year.substring(0, 1)}</div>
                                    <div class="branch">${baziJson2.year.substring(1)}</div>
                                    <div class="label">Year</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson2.month.substring(0, 1)}</div>
                                    <div class="branch">${baziJson2.month.substring(1)}</div>
                                    <div class="label">Month</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson2.day.substring(0, 1)}</div>
                                    <div class="branch">${baziJson2.day.substring(1)}</div>
                                    <div class="label">Day</div>
                                </div>
                                <div class="pillar">
                                    <div class="stem">${baziJson2.time.substring(0, 1)}</div>
                                    <div class="branch">${baziJson2.time.substring(1)}</div>
                                    <div class="label">Hour</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div class="recommendation">
                    <h4>Relationship Advice</h4>
                    <p>${getLoveAdvice(totalScore, zodiac1, zodiac2)}</p>
                </div>
                
                <div class="share-save-section">
                    <div class="share-buttons">
                        <button id="share-btn" class="share-btn">Share Result Link</button>
                        <button id="save-record-btn" class="save-btn">Save This Record</button>
                    </div>
                    <div id="share-link-container" class="share-link-container" style="display: none;">
                        <p>Copy the link below to share with others:</p>
                        <div class="link-input-group">
                            <input type="text" id="share-link" readonly />
                            <button id="copy-link-btn" class="copy-btn">Copy</button>
                        </div>
                    </div>
                </div>
            `;
            
            // 显示结果部分
            resultSection.classList.add('active');
            resultSection.scrollIntoView({ behavior: 'smooth' });
            
            // 如果有八字数据，绘制五行雷达图
            if (baziJson1 && baziJson2) {
                setTimeout(() => {
                    createFiveElementsCharts(baziJson1, baziJson2);
                }, 100);
            }
            
            // 绑定分享和保存功能的事件监听器
            setupShareAndSaveEvents();
        }
        
        // 创建五行雷达图
        function createFiveElementsCharts(baziJson1, baziJson2) {
            // 统计八字1的五行
            const elements1 = countFiveElements(baziJson1);
            const elements2 = countFiveElements(baziJson2);
            
            // 创建第一个雷达图
            createRadarChart('fiveElementsChart1', elements1);
            
            // 创建第二个雷达图
            createRadarChart('fiveElementsChart2', elements2);
        }
        
        // 统计八字中的五行分布
        function countFiveElements(baziJson) {
            const elements = { '金': 0, '木': 0, '水': 0, '火': 0, '土': 0 };
            
            // 天干地支的五行属性
            const stemElements = {
                '甲': '木', '乙': '木', 
                '丙': '火', '丁': '火', 
                '戊': '土', '己': '土', 
                '庚': '金', '辛': '金', 
                '壬': '水', '癸': '水'
            };
            
            const branchElements = {
                '子': '水', '丑': '土', '寅': '木', '卯': '木',
                '辰': '土', '巳': '火', '午': '火', '未': '土',
                '申': '金', '酉': '金', '戌': '土', '亥': '水'
            };
            
            // 地支藏干表（简化版）
            const hiddenStems = {
                '子': ['癸'],
                '丑': ['己', '癸', '辛'],
                '寅': ['甲', '丙', '戊'],
                '卯': ['乙'],
                '辰': ['戊', '乙', '癸'],
                '巳': ['丙', '庚', '戊'],
                '午': ['丁', '己'],
                '未': ['己', '丁', '乙'],
                '申': ['庚', '壬', '戊'],
                '酉': ['辛'],
                '戌': ['戊', '辛', '丁'],
                '亥': ['壬', '甲']
            };
            
            // 柱子权重
            const weights = {
                'year': 1,
                'month': 2,
                'day': 3,
                'time': 1
            };
            
            // 计算每个柱子的五行
            for (const pillar of ['year', 'month', 'day', 'time']) {
                if (baziJson[pillar]) {
                    const stem = baziJson[pillar].substring(0, 1);
                    const branch = baziJson[pillar].substring(1);
                    
                    // 天干五行
                    if (stemElements[stem]) {
                        elements[stemElements[stem]] += weights[pillar];
                    }
                    
                    // 地支本气五行
                    if (branchElements[branch]) {
                        elements[branchElements[branch]] += weights[pillar] * 0.6;
                    }
                    
                    // 地支藏干五行
                    if (hiddenStems[branch]) {
                        hiddenStems[branch].forEach((hiddenStem, idx) => {
                            if (stemElements[hiddenStem]) {
                                // 藏干权重递减
                                const hiddenWeight = weights[pillar] * 0.4 / hiddenStems[branch].length;
                                elements[stemElements[hiddenStem]] += hiddenWeight;
                            }
                        });
                    }
                }
            }
            
            return elements;
        }
        
        // 创建雷达图
        function createRadarChart(canvasId, elements) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            // 转换数据为Chart.js格式
            const data = {
                labels: ['Metal (金)', 'Wood (木)', 'Water (水)', 'Fire (火)', 'Earth (土)'],
                datasets: [{
                    label: 'Five Elements',
                    data: [
                        parseFloat(elements['金'].toFixed(1)), 
                        parseFloat(elements['木'].toFixed(1)), 
                        parseFloat(elements['水'].toFixed(1)), 
                        parseFloat(elements['火'].toFixed(1)), 
                        parseFloat(elements['土'].toFixed(1))
                    ],
                    fill: true,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgb(255, 99, 132)',
                    pointBackgroundColor: 'rgb(255, 99, 132)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(255, 99, 132)'
                }]
            };
            
            // 配置选项
            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    layout: {
                        padding: {
                            top: 5,
                            bottom: 5
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 8,
                            ticks: {
                                stepSize: 2,
                                font: {
                                    size: 10
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: function(context) {
                                        const width = context.chart.width;
                                        return width < 400 ? 9 : 12;
                                    }
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            };
            
            // 创建图表
            new Chart(ctx, config);
            
            // 确保图表居中
            setTimeout(() => {
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    canvas.style.display = 'block';
                    canvas.style.margin = '0 auto';
                }
            }, 100);
        }

        // 生肖配对评价
        function getZodiacCompatibilityComment(score) {
            if (score >= 90) {
                return 'Your zodiac compatibility is extraordinarily high, like a perfect match made in heaven. Your mutual understanding and support provide a solid foundation for love - truly a destined connection!';
            } else if (score >= 75) {
                return 'Your zodiac signs are highly compatible, with complementary personalities that naturally fit together, forming an excellent foundation for a loving relationship. True love finds its way!';
            } else if (score >= 60) {
                return 'Your zodiac relationship shows moderate compatibility, with both commonalities and differences that require harmonizing. This balance is precisely what makes your relationship interesting and dynamic.';
            } else if (score >= 45) {
                return 'Your zodiac signs have some conflicts that require greater tolerance and understanding. However, these very challenges can potentially deepen your emotional bond through growth together.';
            } else {
                return 'Your zodiac signs clash in certain ways, potentially causing significant differences in personality and approaches to life. Yet these complementary aspects might bring unexpected joys and mutual growth.';
            }
        }

        // 五行配对评价
        function getElementCompatibilityComment(element1, element2) {
            if (element1 === element2) {
                return 'You share identical elemental attributes, like looking in a mirror. You effortlessly understand each other\'s thoughts, share similar approaches to life, and possess remarkably aligned values. Your natural harmony is truly exceptional!';
            }
            
            const relationships = {
                '金水': 'Metal generates Water: Like life-giving rain, your relationship is filled with nourishment and support. You give each other strength and confidence, shining brilliantly together like precious metals.',
                '水金': 'Water enhances Metal: Like water carrying a boat, you provide mutual support and confidence, growing together and creating a dazzling future.',
                '木火': 'Wood feeds Fire: Your relationship is filled with passion and creativity, burning bright with motivation like a powerful flame, inspiring each other\'s potential.',
                '火木': 'Fire enhances Wood: Like a gentle spring breeze, your enthusiasm propels each other forward, creating a vibrant love journey.',
                '火土': 'Fire creates Earth: Like sunshine warming the ground, you build a solid relationship foundation through emotional exchange, perfectly complementing each other.',
                '土火': 'Earth supports Fire: Stability containing passion, your relationship is like a volcano gathering strength - secure yet intensely passionate.',
                '土金': 'Earth bears Metal: Like a hidden gold mine, you can create value together, building an abundant life on solid foundations.',
                '金土': 'Metal enhances Earth: You help each other build a stable life, like fine jade and its pedestal, perfectly complementing one another.',
                '水木': 'Water nourishes Wood: Like spring rain on a forest, your relationship is full of vitality and growth, with limitless possibilities together.',
                '木水': 'Wood enhances Water: Like a flowing stream, your relationship is fluid and dynamic, together creating life\'s miracles.',
                '金木': 'Metal challenges Wood: Like a blade cutting wood, you may experience differences in decision-making and action styles, requiring mutual understanding.',
                '木金': 'Wood challenges Metal: Like roots breaking soil, your values and lifestyles may differ, requiring mutual respect.',
                '木土': 'Wood parts Earth: Like roots through soil, you may need to find balance between stability and adventure, requiring more communication.',
                '土木': 'Earth restricts Wood: Like confined growth, your life rhythms and development patterns may differ, requiring you to give each other space.',
                '土水': 'Earth blocks Water: Like a dam restraining water, you may have differences in emotional expression and fluidity, requiring breaking through barriers.',
                '水土': 'Water erodes Earth: Like water washing away soil, you may have different needs for security and freedom, requiring finding balance.',
                '水火': 'Water extinguishes Fire: Like dousing flames, tension may exist between rationality and passion, requiring new ways to express feelings.',
                '火水': 'Fire evaporates Water: Like steam rising, your emotional expression and communication styles may need adjustment to find resonance.',
                '火金': 'Fire melts Metal: Like melting ore, your values and lifestyles may differ, requiring mutual compromise.',
                '金火': 'Metal controls Fire: Like containing flames, your expression styles and passion levels may differ, requiring mutual understanding.'
            };
            
            return relationships[element1 + element2] || 'Your Five Elements relationship is complex and unique, like a destined connection that requires careful nurturing to transform challenges into beautiful harmony.';
        }

        // 爱情建议
        function getLoveAdvice(score, zodiac1, zodiac2) {
            const generalAdvice = [
                'Honest communication is the key to sustaining your relationship. Try to understand each other\'s inner thoughts and feelings, becoming each other\'s confidant.',
                'Accept your differences while finding common interests and values, bringing your hearts closer together every day.',
                'Give each other sufficient space and freedom while maintaining emotional connection. Like an elastic band, a flexible love lasts longer.',
                'Set long-term goals together and work toward them. This shared journey will strengthen your relationship\'s foundation.',
                'Provide support and encouragement during difficult times. Facing challenges together will make your love unbreakable.',
                'Find a reason to say "I love you" every day, even for something as simple as pouring a glass of water. A grateful heart is the most beautiful.',
                'Create surprises and romance. Even a handwritten note or a wildflower can brighten ordinary days and keep your connection fresh.',
                'Learn to express love in ways your partner appreciates. Understanding each other\'s love languages helps love flow more effectively.',
                'Try new things together - whether it\'s recipes, travel destinations, or hobbies. Novelty is the spice of a loving relationship.',
                'Don\'t go to sleep angry after an argument. Reconcile first to prevent small conflicts from growing into larger problems. Love is tolerance and understanding.'
            ];
            
            let specificAdvice = '';
            
            if (score >= 85) {
                specificAdvice = 'Your compatibility score is exceptionally high! Cherish this rare soul connection. Even though you get along beautifully, continue exploring and growing together to keep your relationship fresh, like a gardener tenderly caring for a beautiful garden.';
            } else if (score >= 70) {
                specificAdvice = 'You have an excellent foundation for your relationship, like a solidly built bridge connecting your hearts. Focus on leveraging your individual strengths, appreciating and learning from each other, allowing your love to mature like fine wine, growing richer with time.';
            } else if (score >= 55) {
                specificAdvice = 'Your relationship has challenges but is full of possibilities, like a budding flower waiting to bloom. Practice empathy by putting yourself in each other\'s shoes, understanding each other\'s needs and feelings. Overcoming difficulties together may yield the most delightful fruits of love.';
            } else {
                specificAdvice = 'Though your compatibility score seems low, true love can overcome all obstacles, like plants breaking through rock to grow. If you truly love each other, you\'ll need extra patience and acceptance, along with establishing good communication patterns to create your own love miracle.';
            }
            
            // 根据生肖特点给出具体建议
            const zodiacAdvice = {
                '鼠': 'Your adaptable and sociable nature serves you well, but be careful not to be too calculating. Learn to express feelings genuinely, communicating sincerely rather than cleverly maneuvering.',
                '牛': 'Your reliability and steadiness are your strengths, but sometimes you can be too stubborn. Learn to compromise appropriately and embrace new things, adding freshness to your relationship.',
                '虎': 'Your courage and decisiveness make you charismatic, but control your temper and provide your partner with more security. A gentle gaze is more powerful than a roaring presence.',
                '兔': 'Your gentle and considerate nature is innate, but sometimes you\'re overly sensitive. Learn to express your needs directly rather than always putting yourself last.',
                '龙': 'Your confidence and charm make you radiant, but be careful not to be too self-centered. Learn to listen to and respect your partner\'s opinions, becoming a thoughtful dragon.',
                '蛇': 'Your wisdom and thoughtfulness are your characteristics, but sometimes you\'re too cautious. Learn to be more open and trusting with your partner, loving without reservations.',
                '马': 'Full of energy and optimism, but you may lack patience. Learn to persevere and take responsibility, not giving up on love easily when facing difficulties.',
                '羊': 'Your kindness and creativity make you charming, but sometimes you\'re indecisive. Develop independence and decisiveness, becoming a leader in your relationship.',
                '猴': 'Your cleverness and versatility make you attractive, but sometimes you\'re too active. Learn to calm down and focus on your relationship, becoming a devoted partner.',
                '鸡': 'Your meticulousness is your trademark, but sometimes you\'re too demanding. Learn to accept imperfection and appreciate your partner\'s uniqueness.',
                '狗': 'Loyalty and reliability are your greatest strengths, but sometimes you\'re too suspicious. Learn to trust and let go, not holding onto love too tightly.',
                '猪': 'Your honesty and kindness bring warmth to others, but sometimes you\'re too idealistic. Learn to face realistic challenges and nurture your relationship with practical efforts.'
            };
            
            return `${specificAdvice}<br><br>For you (${translateZodiac(zodiac1)}): ${zodiacAdvice[zodiac1]}<br><br>For your partner (${translateZodiac(zodiac2)}): ${zodiacAdvice[zodiac2]}<br><br>✨ Love Treasure Box ✨<br>${generalAdvice[Math.floor(Math.random() * generalAdvice.length)]}`;
        }

        // 分享和保存功能
        function setupShareAndSaveEvents() {
            const shareBtn = document.getElementById('share-btn');
            const saveBtn = document.getElementById('save-record-btn');
            const copyBtn = document.getElementById('copy-link-btn');
            
            if (shareBtn) {
                shareBtn.addEventListener('click', generateShareLink);
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', saveCurrentRecord);
            }
            
            if (copyBtn) {
                copyBtn.addEventListener('click', copyShareLink);
            }
        }

        // 生成分享链接
        function generateShareLink() {
            const year1 = document.getElementById('year1').value;
            const month1 = document.getElementById('month1').value;
            const day1 = document.getElementById('day1').value;
            const hour1 = document.getElementById('hour1').value;
            
            const year2 = document.getElementById('year2').value;
            const month2 = document.getElementById('month2').value;
            const day2 = document.getElementById('day2').value;
            const hour2 = document.getElementById('hour2').value;
            
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams({
                y1: year1,
                m1: month1,
                d1: day1,
                h1: hour1,
                y2: year2,
                m2: month2,
                d2: day2,
                h2: hour2
            });
            
            const shareUrl = `${baseUrl}?${params.toString()}`;
            
            document.getElementById('share-link').value = shareUrl;
            document.getElementById('share-link-container').style.display = 'block';
        }

        // 复制分享链接
        function copyShareLink() {
            const shareLink = document.getElementById('share-link');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const copyBtn = document.getElementById('copy-link-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                copyBtn.style.backgroundColor = '#34c759';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.backgroundColor = '#ff9500';
                }, 2000);
            } catch (err) {
                console.error('Copy failed:', err);
                alert('Copy failed, please copy the link manually');
            }
        }

        // 保存当前记录
        function saveCurrentRecord() {
            const record = {
                year1: document.getElementById('year1').value,
                month1: document.getElementById('month1').value,
                day1: document.getElementById('day1').value,
                hour1: document.getElementById('hour1').value,
                year2: document.getElementById('year2').value,
                month2: document.getElementById('month2').value,
                day2: document.getElementById('day2').value,
                hour2: document.getElementById('hour2').value,
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('loversMatchRecord', JSON.stringify(record));
                
                const saveBtn = document.getElementById('save-record-btn');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = 'Saved!';
                saveBtn.style.backgroundColor = '#2db84a';
                
                setTimeout(() => {
                    saveBtn.textContent = originalText;
                    saveBtn.style.backgroundColor = 'var(--apple-green)';
                }, 2000);
            } catch (err) {
                console.error('Save failed:', err);
                alert('Save failed, please check your browser settings');
            }
        }

        // 读取保存的记录
        function loadSavedRecord() {
            try {
                const savedRecord = localStorage.getItem('loversMatchRecord');
                if (savedRecord) {
                    const record = JSON.parse(savedRecord);
                    
                    document.getElementById('year1').value = record.year1;
                    document.getElementById('month1').value = record.month1;
                    document.getElementById('day1').value = record.day1;
                    document.getElementById('hour1').value = record.hour1;
                    
                    document.getElementById('year2').value = record.year2;
                    document.getElementById('month2').value = record.month2;
                    document.getElementById('day2').value = record.day2;
                    document.getElementById('hour2').value = record.hour2;
                    
                    // 更新日期选择器（因为月份变化会影响天数）
                    updateDateSelectors();
                    
                    // 隐藏读取记录按钮
                    document.getElementById('load-record-section').style.display = 'none';
                    
                    // 自动计算结果
                    setTimeout(calculateCompatibility, 100);
                }
            } catch (err) {
                console.error('Failed to load record:', err);
            }
        }

        // 从URL参数恢复数据
        function loadFromUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            
            const params = {
                y1: urlParams.get('y1'),
                m1: urlParams.get('m1'),
                d1: urlParams.get('d1'),
                h1: urlParams.get('h1'),
                y2: urlParams.get('y2'),
                m2: urlParams.get('m2'),
                d2: urlParams.get('d2'),
                h2: urlParams.get('h2')
            };
            
            // 检查是否所有参数都存在
            const hasAllParams = Object.values(params).every(param => param !== null && param !== '');
            
            if (hasAllParams) {
                // 等待页面完全加载后再设置值
                setTimeout(() => {
                    document.getElementById('year1').value = params.y1;
                    document.getElementById('month1').value = params.m1;
                    document.getElementById('day1').value = params.d1;
                    document.getElementById('hour1').value = params.h1;
                    
                    document.getElementById('year2').value = params.y2;
                    document.getElementById('month2').value = params.m2;
                    document.getElementById('day2').value = params.d2;
                    document.getElementById('hour2').value = params.h2;
                    
                    // 更新日期选择器
                    updateDateSelectors();
                    
                    // 自动计算结果
                    setTimeout(calculateCompatibility, 200);
                }, 500);
                
                return true;
            }
            
            return false;
        }

        // 更新日期选择器（用于确保日期有效性）
        function updateDateSelectors() {
            // 更新第一个人的日期
            const month1 = parseInt(document.getElementById('month1').value);
            const year1 = parseInt(document.getElementById('year1').value);
            updateDayOptions('day1', year1, month1);
            
            // 更新第二个人的日期
            const month2 = parseInt(document.getElementById('month2').value);
            const year2 = parseInt(document.getElementById('year2').value);
            updateDayOptions('day2', year2, month2);
        }

        // 检查是否有保存的记录
        function checkSavedRecord() {
            try {
                const savedRecord = localStorage.getItem('loversMatchRecord');
                if (savedRecord) {
                    const record = JSON.parse(savedRecord);
                    const loadSection = document.getElementById('load-record-section');
                    loadSection.style.display = 'block';
                    
                    // 绑定读取记录按钮事件
                    document.getElementById('load-record-btn').addEventListener('click', loadSavedRecord);
                }
            } catch (err) {
                console.error('Failed to check saved record:', err);
            }
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟初始化选择器，确保页面首先渲染
            setTimeout(() => {
                initDateSelectors();
                
                // 检查URL参数，如果没有URL参数，则检查保存的记录
                if (!loadFromUrlParams()) {
                    checkSavedRecord();
                }
            }, 10);
            
            // 绑定事件监听器
            document.getElementById('calculate-btn').addEventListener('click', calculateCompatibility);
            document.getElementById('calculate-mbti-btn').addEventListener('click', calculateMbtiCompatibility);
            document.getElementById('bazi-mode-btn').addEventListener('click', () => switchToMode('bazi'));
            document.getElementById('mbti-mode-btn').addEventListener('click', () => switchToMode('mbti'));
        });
    </script>
</body>
</html> 